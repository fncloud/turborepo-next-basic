(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1860],{18477:(e,t,r)=>{Promise.resolve().then(r.bind(r,83120)),Promise.resolve().then(r.bind(r,36302)),Promise.resolve().then(r.bind(r,1468)),Promise.resolve().then(r.bind(r,38798)),Promise.resolve().then(r.t.bind(r,34331,23)),Promise.resolve().then(r.bind(r,56547))},83120:(e,t,r)=>{"use strict";r.d(t,{default:()=>N});var i=r(54568),n=r(32442),l=r(65088),s=r(38434),a=r(27865),u=r(81148),o=r(5591),d=r(99278),c=r(12468),f=r(26525),p=r(46359),m=r(63002),x=r(55146),v=r(44488),h=r(49773),b=r(16399),g=r(69539),y=r(3311),j=r(7620);function N(e){let{subscription:t}=e,r=(0,g.useTranslations)("subscribe"),{common:N}=(0,o.A)(),_=(0,y.useRouter)(),[w,S]=(0,j.useState)({quantity:1,subscribe_id:0,payment:-1,coupon:"",auth_type:"email",identifier:"",password:""}),[O,P]=(0,j.useTransition)(),[q,C]=(0,j.useState)({valid:!1,message:""}),{data:z}=(0,c.I)({enabled:!!(null==t?void 0:t.id)&&!!w.payment,queryKey:["preCreateOrder",w.coupon,w.quantity,w.payment],queryFn:async()=>{let{data:e}=await (0,d.NP)({...w,subscribe_id:null==t?void 0:t.id});return e.data}});(0,j.useEffect)(()=>{t&&S(e=>({...e,quantity:1,subscribe_id:null==t?void 0:t.id}))},[t]);let E=(0,j.useCallback)((e,t)=>{S(r=>({...r,[e]:t}))},[]),k=(0,j.useCallback)(async()=>{P(async()=>{try{let{data:e}=await (0,d.Ov)(w),{order_no:t}=e.data;t&&(localStorage.setItem(t,JSON.stringify({auth_type:w.auth_type,identifier:w.identifier})),_.push("/purchasing/order?order_no=".concat(t)))}catch(e){console.log(e)}})},[w,_,null==t?void 0:t.id]);return t?(0,i.jsxs)("div",{className:"mx-auto mt-8 flex max-w-4xl flex-col gap-8 md:grid md:grid-cols-2 md:flex-row",children:[(0,i.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,i.jsxs)(p.Zp,{children:[(0,i.jsxs)(p.aR,{children:["输入要用于 ",N.site.site_name," 账户的电子邮件地址"]}),(0,i.jsxs)(p.Wu,{className:"flex flex-col gap-2",children:[(0,i.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,i.jsx)(x.z,{className:(0,h.cn)({"border-destructive":!q.valid&&""!==w.identifier}),placeholder:"Email",type:"email",value:w.identifier||"",onValueChange:e=>{if(S(t=>({...t,identifier:e})),/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)){if(N.auth.email.enable_domain_suffix){var t;let r=e.split("@")[1];if(!(null===(t=N.auth.email)||void 0===t?void 0:t.domain_suffix_list.split("\n").includes(r||""))){C({valid:!1,message:"邮箱域名不在白名单中"});return}}else C({valid:!0,message:""})}else C({valid:!1,message:"请输入有效的邮箱地址"})},required:!0}),(0,i.jsx)("p",{className:(0,h.cn)("text-muted-foreground text-xs",{"text-destructive":!q.valid&&""!==w.identifier}),children:q.message||"请填写您的电子邮件地址。"})]}),w.identifier&&q.valid&&(0,i.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,i.jsx)(x.z,{placeholder:"Password",type:"password",value:w.password||"",onValueChange:e=>E("password",e)}),(0,i.jsx)("p",{className:"text-muted-foreground text-xs",children:"如果您不填写密码，我们将会自动生成密码并发送到您的邮箱。"})]})]})]}),(0,i.jsx)(p.Zp,{children:(0,i.jsxs)(p.Wu,{className:"grid gap-3 p-6 text-sm",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold",children:t.name}),(0,i.jsx)("ul",{className:"flex flex-grow flex-col gap-3",children:(()=>{let e;try{e=JSON.parse(t.description)}catch(t){e={description:"",features:[]}}let{description:r,features:n}=e;return(0,i.jsxs)(i.Fragment,{children:[r&&(0,i.jsx)("li",{className:"text-muted-foreground",children:r}),null==n?void 0:n.map((e,t)=>(0,i.jsxs)("li",{className:(0,h.cn)("flex items-center gap-1",{"text-muted-foreground line-through":"destructive"===e.type}),children:[e.icon&&(0,i.jsx)(v.Icon,{icon:e.icon,className:(0,h.cn)("text-primary size-5",{"text-green-500":"success"===e.type,"text-destructive":"destructive"===e.type})}),e.label]},t))]})})()}),(0,i.jsx)(s._,{subscribe:{...t,quantity:w.quantity}}),(0,i.jsx)(m.w,{}),(0,i.jsx)(n.M,{order:{...z,quantity:w.quantity,unit_price:null==t?void 0:t.unit_price}})]})})]}),(0,i.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,i.jsx)(p.Zp,{children:(0,i.jsx)(p.Wu,{className:"p-6",children:(0,i.jsxs)("div",{className:"grid gap-6",children:[(0,i.jsx)(a.A,{quantity:w.quantity,unitTime:null==t?void 0:t.unit_time,discounts:null==t?void 0:t.discount,onChange:e=>E("quantity",e)}),(0,i.jsx)(l.A,{coupon:w.coupon,onChange:e=>E("coupon",e)}),(0,i.jsx)(u.A,{balance:!1,value:w.payment,onChange:e=>E("payment",e)})]})})}),(0,i.jsxs)(f.$,{className:"w-full",size:"lg",disabled:!q.valid||O,onClick:k,children:[O&&(0,i.jsx)(b.A,{className:"mr-2 animate-spin"}),r("buyNow")]})]})]}):(0,i.jsx)("div",{className:"p-6 text-center",children:r("subscriptionNotFound")})}},36302:(e,t,r)=>{"use strict";function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)({}).hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(null,arguments)}r.d(t,{default:()=>s});var n=r(7620),l=r(90523);function s(e){let{locale:t,...r}=e;if(!t)throw Error("Failed to determine locale in `NextIntlClientProvider`, please provide the `locale` prop explicitly.\n\nSee https://next-intl.dev/docs/configuration#locale");return n.createElement(l.IntlProvider,i({locale:t},r))}},65470:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return n}});let i=r(7620);function n(e,t){let r=(0,i.useRef)(()=>{}),n=(0,i.useRef)(()=>{});return(0,i.useMemo)(()=>e&&t?i=>{null===i?(r.current(),n.current()):(r.current=l(e,i),n.current=l(t,i))}:e||t,[e,t])}function l(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let r=e(t);return"function"==typeof r?r:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},55146:(e,t,r)=>{"use strict";r.d(t,{z:()=>a});var i=r(54568),n=r(47019),l=r(49773),s=r(7620);function a(e){let{suffix:t,prefix:r,formatInput:a,formatOutput:u,value:o,className:d,onValueChange:c,onValueBlur:f,...p}=e,m=e=>{if(""===e||0===e||"0"===e)return"";let t=String(null!=e?e:"");return a?a(t):t},[x,v]=(0,s.useState)(()=>m(o)),[h,b]=(0,s.useState)(null!=o?o:"");(0,s.useEffect)(()=>{if(o!==h){let e=m(o);x!==e&&(v(e),b(null!=o?o:""))}},[o,a]);let g=e=>{let t=null==e?void 0:e.toString().trim();return"0"===t&&"number"===p.type?0:(t&&"number"===p.type&&(t=Number(t)),u?u(t):t)};return(0,i.jsxs)("div",{className:(0,l.cn)("border-input flex w-full items-center overflow-hidden rounded-md border",d),suppressHydrationWarning:!0,children:["string"==typeof r?(0,i.jsx)("div",{className:"bg-muted relative mr-px flex h-9 items-center text-nowrap px-3",children:r}):r,(0,i.jsx)(n.p,{step:.01,...p,value:x,className:"block rounded-none border-none",onChange:e=>{let t=e.target.value;if("number"===p.type){if("0"===t){v(""),b(0),null==c||c(0);return}if(/^-?\d*\.?\d*$/.test(t)||"-"===t||"."===t){let e=Number(t);if(isNaN(e)||"-"===t||"."===t)b(t);else{let r=Math.max(Number.isFinite(p.min)?p.min:-1/0,Math.min(Number.isFinite(p.max)?p.max:1/0,e));t=String(r),b(r)}v("0"===t?"":t)}}else v(t),b(t);let r=g(t);null==c||c(r)},onBlur:()=>{if("number"===p.type&&x){if("-"===x||"."===x){v(""),b(""),null==f||f("");return}if("0"===x){v(""),null==f||f(0);return}}let e=g(x);(o||"")!==e&&(null==f||f(e))}}),"string"==typeof t?(0,i.jsx)("div",{className:"bg-muted relative ml-px flex h-9 items-center text-nowrap px-3",children:t}):t]})}},24861:(e,t,r)=>{"use strict";r.d(t,{b:()=>o});var i=r(7620),n=r(67307),l=r(54568),s="horizontal",a=["horizontal","vertical"],u=i.forwardRef((e,t)=>{let{decorative:r,orientation:i=s,...u}=e,o=a.includes(i)?i:s;return(0,l.jsx)(n.sG.div,{"data-orientation":o,...r?{role:"none"}:{"aria-orientation":"vertical"===o?o:void 0,role:"separator"},...u,ref:t})});u.displayName="Separator";var o=u},25891:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var i=r(7620);function n(e){let t=i.useRef({value:e,previous:e});return i.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}},75719:(e,t,r)=>{"use strict";r.d(t,{X:()=>l});var i=r(7620),n=r(67204);function l(e){let[t,r]=i.useState(void 0);return(0,n.N)(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});let t=new ResizeObserver(t=>{let i,n;if(!Array.isArray(t)||!t.length)return;let l=t[0];if("borderBoxSize"in l){let e=l.borderBoxSize,t=Array.isArray(e)?e[0]:e;i=t.inlineSize,n=t.blockSize}else i=e.offsetWidth,n=e.offsetHeight;r({width:i,height:n})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}r(void 0)},[e]),t}},50672:(e,t,r)=>{"use strict";r.d(t,{v:()=>u});var i=r(7620);let n=e=>{let t;let r=new Set,i=(e,i)=>{let n="function"==typeof e?e(t):e;if(!Object.is(n,t)){let e=t;t=(null!=i?i:"object"!=typeof n||null===n)?n:Object.assign({},t,n),r.forEach(r=>r(t,e))}},n=()=>t,l={setState:i,getState:n,getInitialState:()=>s,subscribe:e=>(r.add(e),()=>r.delete(e))},s=t=e(i,n,l);return l},l=e=>e?n(e):n,s=e=>e,a=e=>{let t=l(e),r=e=>(function(e,t=s){let r=i.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return i.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},u=e=>e?a(e):a}},e=>{var t=t=>e(e.s=t);e.O(0,[7503,2249,5627,9463,4999,5215,2468,6577,3135,4690,4305,1722,587,2855,7358],()=>t(18477)),_N_E=e.O()}]);